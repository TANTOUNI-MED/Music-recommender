<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Recommendation System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/styles.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lykmapipo/themify-icons@0.1.2/css/themify-icons.css">
    <script>
        async function loadMusic(category) {
            const response = await fetch(`/get_music/${category}`);
            const musicList = await response.json();
            const contentDiv = document.getElementById('content');
            const mainContentDiv = document.getElementById('main-content');

            contentDiv.innerHTML = `
                <div class="title">
                    <h2>${category} Songs</h2>
                </div>
            `;

            if (musicList.error) {
                contentDiv.innerHTML += `<p>No songs found in this category.</p>`;
                return;
            }

            const musicHTML = musicList.map(music => `
                <div class="music-box">
                    <div class="music-img-box">
                        <div class="img-box">
                            <img src="/static/music.png" alt="${music}" class="retina">
                        </div>
                        <div class="hover-state">
                            <a href="#" onclick="playMusic('${category}', '${music}')">
                                <div class="icon"><span class="ti-control-play"></span></div>
                            </a>
                        </div>
                    </div>
                    <h4 class="title">${music}</h4>
                </div>
            `).join('');

            contentDiv.innerHTML += `<div id="main-content" class="main-content">${musicHTML}</div>`;
        }
        async function playMusic(currentCategory, song) {
    // Extract category from the filename (assuming format: category.uniqueidentifier.wav)
    const extractedCategory = song.split('.')[0];

    // Fetch recommendations
    const recommendResponse = await fetch('/recommend', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            filename: song,
            num_recommendations: 5
        })
    });
    const recommendData = await recommendResponse.json();

    // Create player HTML with a more modern, centered design
    const contentDiv = document.getElementById('content');
    const playerHTML = `
        <div class="title">
            <h2>Now Playing</h2>
        </div>
        <div id="main-content" class="main-content player-container" style="
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 600px;
            margin: 0 auto;
            background: #2a2824;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        ">
            <div class="music-box full-width" style="
                width: 300px;
                margin-bottom: 20px;
            ">
                <div class="music-img-box" style="
                    border-radius: 15px;
                    overflow: hidden;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
                ">
                    <div class="img-box">
                        <img src="/static/music.png" alt="${song}" style="
                            width: 100%;
                            height: 300px;
                            object-fit: cover;
                        ">
                    </div>
                </div>
                
                <div class="music-details" style="
                    text-align: center;
                    margin-top: 15px;
                ">
                    <h3 style="
                        color: #fff;
                        margin-bottom: 5px;
                        font-size: 1.2rem;
                    ">${song}</h3>
                    <p style="
                        color: #b8babc;
                        font-size: 0.9rem;
                    ">${currentCategory}</p>
                </div>
            </div>
            
            <div class="player-controls mt-3" style="
                width: 100%;
                display: flex;
                justify-content: center;
                margin-bottom: 20px;
            ">
                <audio id="music-player" controls style="
                    width: 100%;
                    max-width: 400px;
                "></audio>
            </div>
            
            <div class="recommendations" style="
                width: 100%;
                margin-top: 20px;
            ">
                <div class="title" style="
                    text-align: center;
                    margin-bottom: 15px;
                ">
                    <h2>Recommended for You</h2>
                </div>
                <div class="recommendations-content" style="
                    display: flex;
                    justify-content: center;
                    gap: 15px;
                    flex-wrap: wrap;
                ">
                    ${recommendData.recommendations.map(rec => `
                        <div class="music-box" style="
                            width: 150px;
                            text-align: center;
                            cursor: pointer;
                            transition: transform 0.3s ease;
                        " onclick="playMusic('${currentCategory}', '${rec}')">
                            <div class="music-img-box">
                                <div class="img-box" style="
                                    border-radius: 10px;
                                    overflow: hidden;
                                    margin-bottom: 10px;
                                ">
                                    <img src="/static/music.png" alt="${rec}" style="
                                        width: 100%;
                                        height: 150px;
                                        object-fit: cover;
                                    ">
                                </div>
                            </div>
                            <h4 class="title" style="
                                color: #b8babc;
                                white-space: nowrap;
                                overflow: hidden;
                                text-overflow: ellipsis;
                            ">${rec}</h4>
                        </div>
                    `).join('')}
                </div>
            </div>
        </div>
    `;

    // Update content
    contentDiv.innerHTML = playerHTML;

    // Set up music player
    const musicPlayer = document.getElementById('music-player');
    musicPlayer.src = `/categories/${extractedCategory}/${song}`;
    musicPlayer.play();
}
    </script>
</head>
<body>
    <div id="wrap">
        <div id="sidebar">
            <div id="logo">
                <a href="#">
                    <span class="logo-icon">
                        <span class="ti-control-play"></span>
                    </span>
                    <span class="logo-text">Music RS</span>
                </a>
            </div>
            <div id="menu">
                <ul id="category-list">
                    {% for category in categories %}
                    <li>
                        <a href="#" onclick="loadMusic('{{ category }}')">
                            <span>{{ category }}</span>
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        <div id="content">
            <div class="title">
                <h2>Choose a Category</h2>
            </div>
        </div>
    </div>
</body>
</html>