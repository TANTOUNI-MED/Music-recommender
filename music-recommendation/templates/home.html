<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Recommendation System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/styles.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lykmapipo/themify-icons@0.1.2/css/themify-icons.css">
    <script>
        async function loadMusic(category) {
            const response = await fetch(`/get_music/${category}`);
            const musicList = await response.json();
            const contentDiv = document.getElementById('content');
            const mainContentDiv = document.getElementById('main-content');

            contentDiv.innerHTML = `
                <div class="title">
                    <h2>${category} Songs</h2>
                </div>
            `;

            if (musicList.error) {
                contentDiv.innerHTML += `<p>No songs found in this category.</p>`;
                return;
            }

            const musicHTML = musicList.map(music => `
                <div class="music-box">
                    <div class="music-img-box">
                        <div class="img-box">
                            <img src="https://via.placeholder.com/150" alt="${music}" class="retina">
                        </div>
                        <div class="hover-state">
                            <a href="#" onclick="playMusic('${category}', '${music}')">
                                <div class="icon"><span class="ti-control-play"></span></div>
                            </a>
                        </div>
                    </div>
                    <h4 class="title">${music}</h4>
                </div>
            `).join('');

            contentDiv.innerHTML += `<div id="main-content" class="main-content">${musicHTML}</div>`;
        }

        async function playMusic(category, song) {
            // Fetch recommendations
            const recommendResponse = await fetch('/recommend', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    filename: song,
                    num_recommendations: 5
                })
            });
            const recommendData = await recommendResponse.json();

            // Create player HTML
            const contentDiv = document.getElementById('content');
            const playerHTML = `
                <div class="title">
                    <h2>Now Playing: ${song}</h2>
                </div>
                <div id="main-content" class="main-content">
                    <div class="music-box full-width">
                        <div class="music-img-box">
                            <div class="img-box">
                                <img src="https://via.placeholder.com/300" alt="${song}" class="retina">
                            </div>
                        </div>
                        
                        <div class="player-controls mt-3">
                            <audio id="music-player" controls style="width:100%"></audio>
                        </div>
                    </div>
                    
                    <div class="title mt-4">
                        <h2>Recommendations</h2>
                    </div>
                    <div class="recommendations-content">
                        ${recommendData.recommendations.map(rec => `
                            <div class="music-box">
                                <div class="music-img-box">
                                    <div class="img-box">
                                        <img src="https://via.placeholder.com/150" alt="${rec}" class="retina">
                                    </div>
                                    <div class="hover-state">
                                        <a href="#" onclick="playMusic('${category}', '${rec}')">
                                            <div class="icon"><span class="ti-control-play"></span></div>
                                        </a>
                                    </div>
                                </div>
                                <h4 class="title">${rec}</h4>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;

            // Update content
            contentDiv.innerHTML = playerHTML;

            // Set up music player
            const musicPlayer = document.getElementById('music-player');
            musicPlayer.src = `/categories/${category}/${song}`;
            musicPlayer.play();
        }
    </script>
</head>
<body>
    <div id="wrap">
        <div id="sidebar">
            <div id="logo">
                <a href="#">
                    <span class="logo-icon">
                        <span class="ti-control-play"></span>
                    </span>
                    <span class="logo-text">Spotify</span>
                </a>
            </div>
            <div id="menu">
                <ul id="category-list">
                    {% for category in categories %}
                    <li>
                        <a href="#" onclick="loadMusic('{{ category }}')">
                            <span>{{ category }}</span>
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        <div id="content">
            <div class="title">
                <h2>Choose a Category</h2>
            </div>
        </div>
    </div>
</body>
</html>